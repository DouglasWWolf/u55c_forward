#
#  These can vary per physical installation!
#

bdf0=18:00.0
bdf1=8a:00.0

# Fetch the RTL-ID from both FPGAs
version0=$(pcireg -bdf $bdf0 0x14)
version1=$(pcireg -bdf $bdf1 0x14)

# Ensure that the RTL in FPGA#0 is what we're expecting
if [ $version0 -ne 12126 ]; then
    echo "FPGA card #0 has the wrong RTL ID"
    exit 1
fi

# Ensure that the RTL in FPGA#1 is what we're expecting
if [ $version1 -ne 12126 ]; then
    echo "FPGA card #1 has the wrong RTL ID"
    exit 1
fi

# Issue a "reset" command to the RTL in both FPGAs
pcireg -bdf $bdf0 0x1048 1
pcireg -bdf $bdf1 0x1048 1

# Sleep very briefly to allow the reset to complete
sleep .001